'use strict';if($(".main-body .page-wrapper").find("#purchase-add-container").length||$(".main-body .page-wrapper").find("#purchase-edit-container").length){function a(){let a=``;$(".cost_management_lbl").each(function(){a+=b($(this).text(),$(this).next("label.cost_management_val").text())}),$("#adjust_table").append(a)}function b(a="",b=0){return`<tr class="adjustRow">
                <td class="text-center">
                 <select class="form-control inputAdjustField" name="adjustment[name][]">
                    <option value="" ${""==a?"selected":""}>${jsLang("Select One")}</option>
                    <option value="Custom Duty" ${"Custom Duty"==a?"selected":""}>${jsLang("Custom Duty")}</option>
                    <option value="Discount" ${"Discount"==a?"selected":""}>${jsLang("Discount")}</option>
                    <option value="Foreign Transaction Fee" ${"Foreign Transaction Fee"==a?"selected":""}>${jsLang("Foreign Transaction Fee")}</option>
                    <option value="Freight Fee" ${"Freight Fee"==a?"selected":""}>${jsLang("Freight Fee")}</option>
                    <option value="Insurance" ${"Insurance"==a?"selected":""}>${jsLang("Insurance")}</option>
                    <option value="Rush Fee" ${"Rush Fee"==a?"selected":""}>${jsLang("Rush Fee")}</option>
                    <option value="Surcharge" ${"Surcharge"==a?"selected":""}>${jsLang("Surcharge")}</option>
                    <option value="Other" ${"Other"==a?"selected":""}>${jsLang("Other")}</option>
                  </select>
                  </td>
                  <td class="text-center">
                    <input name="adjustment[amount][]" class="inputAdjustAmount inputFieldDesign form-control text-center positive-float-number" type="text"  value="${b}">
                  </td>
                  <td class="text-center padding_top_18px">
                      <a href="javascript:void(0)" class="closeAdjust"><i class="feather icon-trash"></i></a>
                  </td>
                </tr>`}function c(a,b,c){if(""==$("#vendor_id").val())return $("#error_message").text(jsLang("Please select vendor!")),!1;if(""==$("#location_id").val())return $("#error_message").text(jsLang("Please select location!")),!1;$("#error_message").text("");$.ajax({url:c,dataType:"json",type:"POST",data:{_token:token,search:a.term,vendorId:$("#vendor_id").val()},success:function(a){if(1==a.status){var a=a.products;$("#no_div").css("display","none"),b($.map(a,function(a){return{id:a.id,value:a.name}}))}else $(".ui-menu-item").remove(),$("#no_div").css("top",$("#search").position().top+35),$("#no_div").css("left",$("#search").position().left),$("#no_div").css("width",$("#search").width()),$("#no_div").css("display","block")}})}function d(a,b){var c;for(c=0;c<b.length;c++)if(b[c]==a)return!0;return!1}function e(){$("#supplier_id").select2({ajax:{url:SITE_URL+"/inventory/find-supplier-with-ajax",dataType:"json",delay:250,data:function(a){return{q:a.term,page:a.page,vendorId:$("#vendor_id").val()}},processResults:function(a){let b=a.data;return{results:b}},cache:!0},placeholder:jsLang("Search for supplier by name."),language:{noResults:function(){return`<div>
                          <label>${jsLang("No data found")}</label>
                          <br>
                            <a class="options-add-two mt-2 float-right" id="supplier_modal" style="margin-bottom: 12px !important;margin-top: -8px !important;">
                              ${jsLang("Add New Supplier")}
                            </a>
                         </div>
            </li>`}},escapeMarkup:function(a){return a},minimumInputLength:3})}function f(){$("#location_id").select2({ajax:{url:SITE_URL+"/inventory/find-location-with-ajax",dataType:"json",delay:250,data:function(a){return{q:a.term,page:a.page,vendorId:$("#vendor_id").val()}},processResults:function(a){let b=a.data;return{results:b}},cache:!0},placeholder:jsLang("Search for location by name."),language:{noResults:function(){return`<div>
                          <label>${jsLang("No data found")}</label>
                          <br>
                            <a class="options-add-two mt-2 float-right" id="location_modal" style="margin-bottom: 12px !important;margin-top: -8px !important;">
                              ${jsLang("Add New Location")}
                            </a>
                         </div>
            </li>`}},escapeMarkup:function(a){return a},minimumInputLength:3})}function g(){let a=0,b=0;$(".inputQty").each(function(){let c=$(this).attr("data-rowId");const d=a=>"."===thousandSeparator?parseFloat(a.replace(/\./g,"")):parseFloat(a.replace(/,/g,"")),e=a=>parseFloat(d($(a).val()))||0,f=e("#product_qty_"+c),g=e("#product_cost_"+c),h=e("#product_tax_"+c),i=f*g,j=i*h/100;a+=j;let k=i+j;b+=k,$("#product_amount_"+c).text(getDecimalNumberFormat(k))}),$("#subTotalTax").text(getDecimalNumberFormat(a)),$("#subTotalAmount").text(getDecimalNumberFormat(b)),totalAmount=b,k(!1),h(totalAmount)}function h(a){$("#totalAmount").text(getDecimalNumberFormat(a))}function j(){0==$(".closeRow").length?$("#product-table").addClass("display_none"):$("#product-table").removeClass("display_none")}function k(a=!0){let b=``;$(".inputAdjustField").each(function(){if($(this).val()){let a=parseFloat($(this).closest("td").next().find("input.inputAdjustAmount").val()?$(this).closest("td").next().find("input.inputAdjustAmount").val():0);totalAmount+=a,b+=`
                <div class="form-group row customHtml">
                    <label class="col-form-label col-md-6 cost_management_lbl">${$(this).val()?$(this).val():""}</label>
                    <label class="col-form-label col-md-6 cost_management_val">${getDecimalNumberFormat(a)}</label>
                </div>
                `}}),a?$("#cost_management").append(b):totalAmount+=parseFloat($("#adjust_shipping_amount").val()?$("#adjust_shipping_amount").val():0)}function l(a){a?($("#location_state").html(""),$.ajax({url:url+"/geo-locale/countries/"+a+"/states",type:"GET",dataType:"json",beforeSend:function(){$("#location_state").attr("disabled","true"),$("#location_state").html(loader)},success:function(a){$("#location_state").html(selectState),$.each(a.data,function(a,b){$("#location_state").append(`'<option ${b.code==oldState?"Selected":""} data-state="${b.code}" value="${b.code}">${b.name}</option>'`)}),$("#location_state").removeAttr("disabled"),0>=a.length&&0>=a.data.length&&(errorMsg=errorMsg.replace(":x","State"),$("#location_state").html(`<option value="">${errorMsg}</option>`))}})):($("#location_state").html(selectState),$("#location_city").html(selectCity))}function m(a,b){a&&b?($("#location_city").html(""),$.ajax({url:url+"/geo-locale/countries/"+b+"/states/"+a+"/cities",type:"GET",dataType:"json",beforeSend:function(){$("#location_city").html(loader),$("#location_city").attr("disabled","true")},success:function(a){$("#location_city").html(selectCity),$.each(a.data,function(a,b){$("#location_city").append(`<option ${b.name==oldCity?"Selected":""} value="${b.name}">${b.name}</option>`)}),$("#location_city").removeAttr("disabled"),0>=a.length&&0>=a.data.length&&(errorMsg=errorMsg.replace(":x","City"),$("#location_city").html(`<option value="">${errorMsg}</option>`))}})):$("#location_city").html(selectCity)}function n(a,b,c,d,e){$.ajax({type:"POST",url:a,data:b,dataType:"JSON",contentType:!1,cache:!1,processData:!1,success:function(a){!0==a.status?($(d).append(`<option value="${a.response.id}" selected>${a.response.name}</option>`),$(d).trigger("change"),$(c).modal("hide"),o(a.message)):o(a.message)},complete:function(){$(e).each(function(){this.reset()})}})}var stack=[];$(".main-body .page-wrapper").find("#purchase-add-container").length&&$("input[name=\"arrival_date\"]").daterangepicker(dateSingleConfig()),$(".main-body .page-wrapper").find("#purchase-edit-container").length&&($("input[name=\"arrival_date\"]").daterangepicker(dateSingleConfig($("input[name=\"arrival_date\"]").val())),stack=JSON.parse(editStack)),$("#purchase_form").on("submit",function(a){0==$(".itemRow").length&&(a.preventDefault(),$("#error_message").text(jsLang("Please add product!")))}),$("#settings_modal").on("click",function(){$(".adjustRow").remove(),0==$(".cost_management_val").length&&(totalAmount-=parseFloat($("#cost_management_shipping").text())),$("#adjust_shipping_amount").val(parseFloat($("#cost_management_shipping").text())),a(),$("#myModal").modal("show")}),$("#search").autocomplete({delay:500,position:{my:"left top",at:"left bottom",collision:"flip"},source:function(a,b){c(a,b,SITE_URL+"/inventory/purchase/product-search")},select:function(a,b){var c=b.item;if(c.id){if(!d(c.id,stack)){stack[c.id]=c.id;var e=`<tbody id="rowId-${rowNo}" class="purchase_products">
                          <input type="hidden" name="product_id[]" value="${c.id}">
                          <tr class="itemRow rowNo-${rowNo}" id="productId-${c.id}"  data-row-no="${rowNo}">
                              <td class="pl-1">
                              <input type="hidden" name="product_name[]" value="${c.value}">
                                  ${c.value}
                              </td>
                              
                              <td class="sup_sku">
                                  <input name="sup_sku[]" id="sup_sku_${rowNo}" class="form-control text-center" type="text">
                              </td>
                              
                              <td class="productQty">
                                  <input name="product_qty[]" id="product_qty_${rowNo}" class="inputQty form-control text-center positive-float-number" type="text" value="1" data-rowId = ${rowNo}>
                              </td>
                              <td class="productCost">
                                <input id="product_cost_${rowNo}" name="product_cost[]" class="inputCost form-control text-center positive-float-number" type="text"  value="0">
                              </td>
                             
                              <td class="productTax min-width-145">
                                  <input  id="product_tax_${rowNo}" type="text" class="inputTax form-control text-center positive-float-number" name="product_tax[]" value="0">
                              </td>
                              <td class="productAmount">
                                  <span class="form-control text-center" id="product_amount_${rowNo}">0</span>
                              </td>
                              <td class="text-center padding_top_15px">
                                  <a href="javascript:void(0)" class="closeRow" data-row-id="${rowNo}" data-id="${c.id}"><i class="feather icon-trash"></i></a>
                              </td>
                          </tr>
                          
                      </tbody>`;$("#product-table").append(e),j(),rowNo++}return $("#productId-"+c.id).find(".inputQty").trigger("blur"),!1}},minLength:1,autoFocus:!0}).autocomplete("instance")._renderItem=function(a,b){return d(b.id,stack)?$("<li style='pointer-events:none;opacity:0.6;'>").append("<div>"+b.value+"</div>").appendTo(a):$("<li>").append("<div>"+b.value+"</div>").appendTo(a)},$(".main-body .page-wrapper").find("#purchase-add-container").length&&(e(),f()),$(".main-body .page-wrapper").find("#purchase-add-container").length&&$("#vendor_id").select2({ajax:{url:SITE_URL+"/inventory/find-vendor-with-ajax",dataType:"json",delay:250,data:function(a){return{q:a.term,page:a.page}},processResults:function(a){let b=a.data;return{results:b}},cache:!0},placeholder:jsLang("Search for vendor by name."),minimumInputLength:3}),$(document).on("change",".inputQty, .inputCost, .inputTax",function(){$(this).hasClass("inputQty")&&$(this).val(parseInt($(this).val())),g()}),$(document).on("click",".closeRow",function(a){a.preventDefault();let b="#rowId-"+$(this).attr("data-row-id"),c=$(this).attr("data-id"),d=0;for($(b).remove(),d=0;d<stack.length;d++)stack[d]==c&&stack.splice(d,1,0);j(),g()}),$(document).on("change",".inputQty, .inputCost, .inputTax",function(){g()}),$("#vendor_id").on("change",function(){$(".purchase_products").remove(),$("#location_id").val(null).trigger("change"),$("#supplier_id").val(null).trigger("change"),$("#supplier_add_vendorId").val($(this).val()),$("#location_add_vendorId").val($(this).val()),stack=[],j()}),$("#location_id").on("change",function(){$(".purchase_products").remove(),stack=[],j()}),$("#adjustmentBtn").on("click",function(){$("#adjust_table").append(b())}),$(document).on("click",".closeAdjust",function(a){a.preventDefault(),$(this).parent().parent().remove()}),$(document).on("click",".close",function(a){a.preventDefault(),$("#myModal").modal("hide")}),$("#adjustSave").on("click",function(){if(0==$(".itemRow").length)return void o(jsLang("Please add product first!"));0<$(".customHtml").length&&($(".cost_management_val").each(function(){totalAmount-=parseFloat($(this).text()?$(this).text():0)}),totalAmount-=parseFloat($("#cost_management_shipping").text()?$("#cost_management_shipping").text():0),$(".customHtml").remove());let a=parseFloat($("#adjust_shipping_amount").val()?$("#adjust_shipping_amount").val():0);totalAmount+=a,$("#cost_management_shipping").text(a),k(),h(totalAmount),$("#myModal").modal("hide")}),$(document).on("change",".inputAdjustAmount",function(){let a=$(this).closest("td").prev().find("select.inputAdjustField").val();if("Discount"==a){let a=$(this).val()?$(this).val():0;$(this).val(-a)}});const o=a=>{$(".notification-msg-bar").find(".notification-msg").html(a),$(".notification-msg-bar").removeClass("smoothly-hide"),setTimeout(()=>{$(".notification-msg-bar").addClass("smoothly-hide"),$(".notification-msg-bar").find(".notification-msg").html("")},2500)};$(document).on("click","#supplier_modal",function(){e(),$("#addSupplier").modal("show")}),$(".supplierModalClose").on("click",function(){$("#addSupplier").modal("hide")}),$(document).on("click","#location_modal",function(){f(),$("#addLocation").modal("show")}),$(".locationModalClose").on("click",function(){$("#addLocation").modal("hide")}),$("#location_country").on("change",function(){l($("#location_country").find(":selected").attr("data-country"))}),$("#location_state").on("change",function(){m($("#location_state").find(":selected").attr("data-state"),$("#location_country").find(":selected").attr("data-country"))}),$("#supplierFrom").on("submit",function(a){a.preventDefault(),n(addSupplierUrl,new FormData(this),"#addSupplier","#supplier_id","#supplierFrom")}),$("#locationFrom").on("submit",function(a){a.preventDefault(),n(addLocation,new FormData(this),"#addLocation","#location_id","#locationFrom")})}
