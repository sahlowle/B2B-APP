'use strict';if($(".main-body .page-wrapper").find("#transfer-add-container").length||$(".main-body .page-wrapper").find("#transfer-edit-container").length){function a(a,b){var c;for(c=0;c<b.length;c++)if(b[c]==a)return!0;return!1}function b(){0==$(".closeRow").length?$("#product-table").addClass("display_none"):$("#product-table").removeClass("display_none")}function c(a,b,c){if(""==$("#vendor_id").val())return $("#error_message").text(jsLang("Please select vendor!")),!1;if(""==$("#from_location_id").val())return $("#error_message").text(jsLang("Please select origin!")),!1;$("#error_message").text("");$.ajax({url:c,dataType:"json",type:"POST",data:{_token:token,search:a.term,vendorId:$("#vendor_id").val(),fromLocationId:$("#from_location_id").val()},success:function(a){if(1==a.status){var a=a.products;$("#no_div").css("display","none"),b($.map(a,function(a){return{id:a.id,value:a.name,qty:a.total_quantity,sku:a.sku}}))}else $(".ui-menu-item").remove(),$("#no_div").css("top",$("#search").position().top+35),$("#no_div").css("left",$("#search").position().left),$("#no_div").css("width",$("#search").width()),$("#no_div").css("display","block")}})}var stack=[];$(".main-body .page-wrapper").find("#transfer-add-container").length&&$("input[name=\"arrival_date\"]").daterangepicker(dateSingleConfig()),$(".main-body .page-wrapper").find("#transfer-edit-container").length&&($("input[name=\"arrival_date\"]").daterangepicker(dateSingleConfig($("input[name=\"arrival_date\"]").val())),stack=JSON.parse(editStack)),$("#search").autocomplete({delay:500,position:{my:"left top",at:"left bottom",collision:"flip"},source:function(a,b){c(a,b,SITE_URL+"/inventory/transfer/product-search")},select:function(c,d){var f=d.item;if(f.id){if(!a(f.id,stack)){stack[f.id]=f.id;var e=`<tbody id="rowId-${rowNo}" class="transfer_products">
                          <input type="hidden" name="product_id[]" value="${f.id}">
                          <tr class="itemRow rowNo-${rowNo}" id="productId-${f.id}"  data-row-no="${rowNo}">
                              <td class="pl-1">
                                  ${f.value}
                              </td>
                              
                              <td class="sku">
                                  <input id="sku_${rowNo}" class="form-control text-center" type="text" readonly value="${f.sku}">
                              </td>
                              
                              <td class="productQty">
                                  <input name="product_qty[]" id="product_qty_${rowNo}" class="inputQty form-control text-center" type="number" value="1" data-rowId = ${rowNo} max="${f.qty}">
                              </td>
                              <td class="text-center padding_top_15px">
                                  <a href="javascript:void(0)" class="closeRow" data-row-id="${rowNo}" data-id="${f.id}"><i class="feather icon-trash"></i></a>
                              </td>
                          </tr>
                          
                      </tbody>`;$("#product-table").append(e),b(),rowNo++}return $("#productId-"+f.id).find(".inputQty").trigger("blur"),!1}},minLength:1,autoFocus:!0}).autocomplete("instance")._renderItem=function(b,c){return a(c.id,stack)?$("<li style='pointer-events:none;opacity:0.6;'>").append("<div>"+c.value+"</div>").appendTo(b):$("<li>").append("<div>"+c.value+"</div>").appendTo(b)},function(){$(".location").select2({ajax:{url:SITE_URL+"/inventory/find-location-with-ajax",dataType:"json",delay:250,data:function(a){return{q:a.term,page:a.page,vendorId:$("#vendor_id").val(),from_location_id:$("#from_location_id").val(),to_location_id:$("#to_location_id").val()}},processResults:function(a){let b=a.data;return{results:b}},cache:!0},placeholder:jsLang("Search for location by name."),escapeMarkup:function(a){return a},minimumInputLength:3,allowClear:!0})}(),$(".main-body .page-wrapper").find("#transfer-add-container").length&&$("#vendor_id").select2({ajax:{url:SITE_URL+"/inventory/find-vendor-with-ajax",dataType:"json",delay:250,data:function(a){return{q:a.term,page:a.page}},processResults:function(a){let b=a.data;return{results:b}},cache:!0},placeholder:jsLang("Search for vendor by name."),minimumInputLength:3}),$(document).on("keyup change",".inputQty",function(){let a=parseFloat($(this).attr("max"));$(this).val(parseInt($(this).val())),parseFloat($(this).val())>a&&$(this).val(a),0>parseFloat($(this).val())&&$(this).val(0)}),$(document).on("click",".closeRow",function(a){a.preventDefault();let c="#rowId-"+$(this).attr("data-row-id"),d=$(this).attr("data-id"),e=0;for($(c).remove(),e=0;e<stack.length;e++)stack[e]==d&&stack.splice(e,1,0);b()}),$("#vendor_id").on("change",function(){$(".transfer_products").remove(),stack=[],$("#from_location_id").val(null).trigger("change"),b()}),$("#from_location_id").on("change",function(){$(".transfer_products").remove(),stack=[],b()})}
